<!DOCTYPE html><html><head> <style> @font-face { font-family: "allseto"; src: url("https://raw.githubusercontent.com/yurenli0217/BoshiahkGV/master/Config/cjkFonts_allseto_v1.11.ttf"); } * { font-family: "allseto", serif; padding: 0; margin: 0; } #main { height: 100vh; width: 100vw; } #main .title { font-size: 10rem; text-align: center; padding-top: 10rem; } #main .file-select { text-align: center; font-size: 2rem; padding-top: 3rem; } #main .file-select label { border-radius: 5px; border-style: solid; border-width: 1px; cursor: pointer; padding: 5px 10px; color: white; background-color: rgb(59, 88, 88); transition: transform 2s; display: inline-block; } #main .file-select label.trans { transform: translateY(600px); } #main .status.hide { max-height: 0; overflow-y: hidden; opacity: 0; } #main .status.show { max-height: 100vh; overflow-y: initial; opacity: 1; } #main .status { padding-top: 2rem; text-align: center; font-size: 1.2rem; transition: all 2s; } #main .big5-check { text-align: center; font-size: 1rem; } #main .status #status-cover { padding: 2rem; font-size: 5rem; position: relative; display: inline-flex; height: 15rem; width: 15rem; justify-content: center; align-items: center; margin: 15px; } #main .status #status-cover::after { border-radius: 50%; position: absolute; content: ""; border-style: solid; height: 100%; width: 100%; border-width: 10px; } #main .status #status-cover.spin::after { border-top-color: rgb(118, 71, 230); animation-name: border-spin; animation-duration: 2s; animation-timing-function: linear; animation-iteration-count: infinite; } #main .status #status-text { padding-top: 2rem; font-size: 1.5rem; } #main .status #status-text-ps { padding-top: 1.5rem; font-size: 1.2rem; } @keyframes border-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } </style></head><body> <div id="main"> <div class="title"> 作業批改程序 </div> <div class="status hide"> <div id="status-cover"></div> <div id="status-text"></div> <div id="status-text-ps"></div> </div> <div class="file-select"> <label for="zip-file" class=""> <span id="file-btn"> 選擇檔案 </span> </label> <input type="file" id="zip-file" style="display: none"> </div> </div> <div style="display:none"> <div> <div> 名字部分 </div> <div id="name"></div> <div> 正確答案 </div> <div id="name-answer"></div> <div> 驗證結果 </div> <div id="name-verify"></div> </div> <hr> <div> <div> 龍部分 </div> <div id="ryu"></div> <div> 正確答案 </div> <div id="ryu-answer"></div> <div> 驗證結果 </div> <div id="ryu-verify"></div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.26.2/docxtemplater.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.6.1/jszip.min.js"></script> <script src="./utf8.js"></script> <script src="https://cdn.jsdelivr.net/gh/jcubic/static@master/js/iconv.js"></script> <script> document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("zip-file");document.getElementById("file-btn").onclick=function(){e.value=null},e.onchange=function(){if("application/x-zip-compressed"!=e.files[0].type)return console.error("Not a valid zip file");var m=document.getElementById("status-cover"),p=document.getElementById("status-text"),d=document.getElementById("status-text-ps");m.parentNode.classList.remove("hide"),m.parentNode.classList.add("show"),m.classList.add("spin"),m.innerText="讀取中",p.innerText="讀取壓縮檔中...",setTimeout(function(){m.innerText="解析中",p.innerText="解析檔案中...";var u=new FileReader;u.onload=function(){for(var e=new JSZip(u.result),t=Object.keys(e.files),l=[],n=0;n<t.length;n++){var r=t[n],i=r.split("/")[0].split("_").slice(-1)[0],a=r.split("/")[0].split("_")[0],o=r.split("/")[1].split(".").slice(-1)[0],r=e.files[r].asArrayBuffer();l.push({no:a,name:i,ext:o,bin:r})}var s=[["姓名","UTF-16 LE","UTF-16 BE","UTF-8","備註"]],c=!1;(function e(n){var t=l[n];n==l.length-1&&(c=!0);m.innerText=t.name,p.innerHTML='正在批改<span style="color: blue">'+t.name+"</span>同學 ("+(100*(n+1)/l.length).toFixed(2)+"%)",d.innerText="正在比對資訊...";var r,i,a=[t.name];"docx"!=t.ext?(d.innerText="格式錯誤，並非 .docx 格式...",(a=a.concat(["---","---","---"])).push("格式錯誤，並非 docx 格式")):(t=t.bin,t=new JSZip(t),t=new docxtemplater(t,{linebreaks:!0}).createTemplateClass("word/document.xml"),t=(new DOMParser).parseFromString(t.content,"application/xml").getElementsByTagName("w:body")[0].getElementsByTagName("w:tbl")[0],r=Array.from(Array.from(t.getElementsByTagName("w:tr")).slice(-1)[0].getElementsByTagName("w:tc")).map(function(e){return e.textContent.replace(/\s+/g,"")}).slice(2).map(function(e){e=e.split("").reverse().join("").match(/[0-1]{8}/);return null===e?null:parseInt(e[0].split("").reverse().join(""),2)}),i=[99,216,59,220,216,99,220,59,240,168,176,187],t=new Array(i.length).fill().map(function(e,t){if((t+1)%4!=0)return null;for(var n=t;n<t+4;n++)if("錯誤"==(r[n]===i[n]?"正確":"錯誤"))return"錯誤";return"正確"}).filter(function(e){return null!==e}),(a=a.concat(t)).push("")),s.push(a),setTimeout(function(){var t;c?(m.innerText="完成",d.innerText="",m.classList.remove("spin"),d.innerHTML='<a href="javascript:void(0);"> 點擊下載批改的 CSV 結果 </a>',t="",s.forEach(function(e){t+=e.join(",")+"\n"}),d.querySelector("a").onclick=function(){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([t],{type:"text/plain"})),e.download="批改結果.csv",e.click(),setTimeout(function(){URL.revokeObjectURL(e.href)},50)}):e(n+1)},50)})(0)},u.readAsArrayBuffer(e.files[0])},2e3)}}); </script></body></html>