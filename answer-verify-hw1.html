<!DOCTYPE html><html><head> <style>@font-face{font-family: "allseto"; src: url("https://raw.githubusercontent.com/yurenli0217/BoshiahkGV/master/Config/cjkFonts_allseto_v1.11.ttf");}*{font-family: "allseto", serif; padding: 0; margin: 0;}#main{height: 100vh; width: 100vw;}#main .title{font-size: 10rem; text-align: center; padding-top: 10rem;}#main .file-select{text-align: center; font-size: 2rem; padding-top: 3rem;}#main .file-select label{border-radius: 5px; border-style: solid; border-width: 1px; cursor: pointer; padding: 5px 10px; color: white; background-color: rgb(59, 88, 88); transition: transform 2s; display: inline-block;}#main .file-select label.trans{transform: translateY(600px);}#main .status.hide{max-height: 0; overflow-y: hidden; opacity: 0;}#main .status.show{max-height: 100vh; overflow-y: initial; opacity: 1;}#main .status{padding-top: 2rem; text-align: center; font-size: 1.2rem; transition: all 2s;}#main .big5-check{text-align: center; font-size: 1rem;}#main .status #status-cover{padding: 2rem; font-size: 5rem; position: relative; display: inline-flex; height: 15rem; width: 15rem; justify-content: center; align-items: center; margin: 15px;}#main .status #status-cover::after{border-radius: 50%; position: absolute; content: ""; border-style: solid; height: 100%; width: 100%; border-width: 10px;}#main .status #status-cover.spin::after{border-top-color: rgb(118, 71, 230); animation-name: border-spin; animation-duration: 2s; animation-timing-function: linear; animation-iteration-count: infinite;}#main .status #status-text{padding-top: 2rem; font-size: 1.5rem;}#main .status #status-text-ps{padding-top: 1.5rem; font-size: 1.2rem;}@keyframes border-spin{from{transform: rotate(0deg);}to{transform: rotate(360deg);}}</style></head><body> <div id="main"> <div class="title"> 作業批改程序 </div><div class="big5-check"> <label for="big5-checkbox"> 使用 CNS11643 查詢 BIG-5 </label> <input type="checkbox" id="big5-checkbox"> </div><div class="status hide"> <div id="status-cover"></div><div id="status-text"></div><div id="status-text-ps"></div></div><div class="file-select"> <label for="zip-file" class=""> <span id="file-btn"> 選擇檔案 </span> </label> <input type="file" id="zip-file" style="display: none"> </div></div><div style="display:none"> <div> <div> 名字部分 </div><div id="name"></div><div> 正確答案 </div><div id="name-answer"></div><div> 驗證結果 </div><div id="name-verify"></div></div><hr> <div> <div> 龍部分 </div><div id="ryu"></div><div> 正確答案 </div><div id="ryu-answer"></div><div> 驗證結果 </div><div id="ryu-verify"></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.26.2/docxtemplater.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.6.1/jszip.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/jcubic/static@master/js/iconv.js"></script> <script>var isIconv=!0;document.getElementById("big5-checkbox").onchange=function(e){isIconv=!e.target.checked};var corsServer="https://ntut-cors.herokuapp.com/";document.addEventListener("DOMContentLoaded",function(){function h(e,n){return e.toString().trim().replace(/u\+|0x/i,"").toLowerCase()==n.toString().trim().toLowerCase()?"正確":"錯誤"}function g(e,n){e=new JSZip(e);var t=new docxtemplater(e,{linebreaks:!0}).createTemplateClass("word/document.xml"),o=[],i="";e=!1;try{var r=(new DOMParser).parseFromString(t.content,"application/xml").getElementsByTagName("w:body")[0].getElementsByTagName("w:tbl")[0],r=Array.from(r.getElementsByTagName("w:tr")).slice(1);tableCol=r.map(function(e){return Array.from(e.getElementsByTagName("w:tc")).map(function(e){return e.textContent})})}catch(n){i+="word 資料有誤，無法讀取",e=!0}if(e)o=o.concat(new Array(27).fill("錯誤"));else{for(var c=Object.keys(n).length,a=tableCol.slice(0,c),s=tableCol.slice(11,tableCol.length),l=0;l<a.length;l++){var u=a[l],d=u[0].codePointAt(0).toString(16).toUpperCase(),p=u[0].codePointAt(0),m=n[u[0]];void 0!==m?(o.push(h(u[1],d)),o.push(h(u[2],p)),o.push(h(u[3],m))):(o.push("錯誤"),o.push("錯誤"),o.push("錯誤"),i+="姓名部分未按格式作答；")}if(c<3)for(l=1;l<=3-c;l++)o.push("---"),o.push("---"),o.push("---");var f=[["7ADC","31452","957C"],["9F99","40857","N/A"],["9F8D","40845","C073"],["9F96","40854","N/A"],["9F98","40856","F9D5"],["2A6A5","173733","N/A"]];["竜","龙","龍","龖","龘","𪚥"].forEach(function(e,n){var t=s[n];n=f[n],o.push(h(t[1],n[0])),o.push(h(t[2],n[1])),o.push(h(t[3],n[2]))})}return o.push(i),o}var e=document.getElementById("zip-file");document.getElementById("file-btn").onclick=function(){e.value=null},e.onchange=function(){if("application/x-zip-compressed"!=e.files[0].type)return console.error("Not a valid zip file");var p=document.getElementById("status-cover"),m=document.getElementById("status-text"),f=document.getElementById("status-text-ps");p.parentNode.classList.remove("hide"),p.parentNode.classList.add("show"),p.classList.add("spin"),p.innerText="讀取中",m.innerText="讀取壓縮檔中...",setTimeout(function(){p.innerText="解析中",m.innerText="解析檔案中...";var s=new FileReader;s.onload=function(){for(var e=new JSZip(s.result),n=Object.keys(e.files),i=[],t=0;t<n.length;t++){var o=(a=n[t]).split("/")[0].split("_").slice(-1)[0],r=a.split("/")[0].split("_")[0],c=a.split("/")[1].split(".").slice(-1)[0],a=e.files[a].asArrayBuffer();i.push({no:r,name:o,ext:c,bin:a})}var u=[["學號","格式","姓名","姓 Unicode","姓 DecimalUnicode","姓 Big5","名 Unicode","名 DecimalUnicode","名 Big5","名 Unicode","名 DecimalUnicode","名 Big5","竜 Unicode","竜 DecimalUnicode","竜 Big5","龙 Unicode","龙 DecimalUnicode","龙 Big5","龍 Unicode","龍 DecimalUnicode","龍 Big5","龖 Unicode","龖 DecimalUnicode","龖 Big5","龘 Unicode","龘 DecimalUnicode","龘 Big5","𪚥 Unicode","𪚥 DecimalUnicode","𪚥 Big5","備註"]],d=!1;!function e(t){var c,a,s,l,n=i[t];function o(){setTimeout(function(){var n;d?(p.innerText="完成",f.innerText="",p.classList.remove("spin"),f.innerHTML='<a href="javascript:void(0);"> 點擊下載批改的 CSV 結果 </a>',n="",u.forEach(function(e){n+=e.join(",")+"\n"}),f.querySelector("a").onclick=function(){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([n],{type:"text/plain"})),e.download="批改結果.csv",e.click(),setTimeout(function(){URL.revokeObjectURL(e.href)},50)}):e(t+1)},50)}t==i.length-1&&(d=!0),p.innerText=n.name,m.innerHTML='正在批改<span style="color: blue">'+n.name+"</span>同學 ("+(100*(t+1)/i.length).toFixed(2)+"%)",f.innerText="正在從 CNS11643 獲取大五碼資料...","docx"!=n.ext?(f.innerText="格式錯誤，並非 .docx 格式...",u.push([n.no,n.ext,n.name].concat(new Array(27).fill("---")).concat(["格式錯誤，並非 word .docx 格式"])),o()):isIconv?(f.innerText="獲取大五碼資料...",setTimeout(function(){var e=n.name.split("").reduce(function(e,n){return e[n]=Array.from(iconv.encode(n,"big5")).map(function(e){return e.toString(16)}).join("").toUpperCase(),e},{});f.innerText="正在比對資訊...",e=[n.no,n.ext,n.name].concat(g(n.bin,e)),u.push(e),o()},100)):(c=n.name,s=!(a=function(e){f.innerText="正在比對資訊...",e=[n.no,n.ext,n.name].concat(g(n.bin,e)),u.push(e),o()}),l={},function n(t){var e,o,i,r=c[t];t==c.length-1&&(s=!0),e=r,o=function(e){return null===e?l[r]="N/A":(e=(new DOMParser).parseFromString(e,"text/html"),e=Array.from(e.querySelectorAll(".wordTab div.col4 div")).map(function(e){return Array.from(e.children).map(function(e){return e.innerText.trim().toUpperCase()})}).find(function(e){return/BIG.*5/.test(e[0])}),l[r]=void 0!==e?e[1]:"N/A"),s?a(l):n(t+1)},(i=new XMLHttpRequest).onload=function(){200==i.status?o(i.responseText):o(null)},i.open("POST",corsServer+"https://www.cns11643.gov.tw/searchQ.jsp"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),i.send("SN="+encodeURIComponent(e))}(0))}(0)},s.readAsArrayBuffer(e.files[0])},2e3)}}); </script></body></html>